<html lang="en">
<head>
    <title>RTC Client</title>
    <script src="js/rtc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        html {
            color-scheme: dark !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 40px;
            background-color: #2c2f30;
            color: #fcf7f1;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .card {
            background-color: #252627;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            width: 100%;
            max-width: 95%;
            display: inline-block;
            margin: 10px;
        }

        .code-container {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-container pre {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 16px;
            padding: 0;
            margin: 0;
        }

        .send-btn {
            background-color: #0082a1;
            color: #e5dfd1;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .send-btn:hover {
            background-color: #4fa3d1;
            transform: scale(1.05);
        }

        .send-btn:focus {
            outline: none;
        }

        .card-header {
            font-size: 20px;
            font-weight: bold;
            color: whitesmoke;
            margin-bottom: 15px;
        }

    </style>

</head>
<body>
<div class="card">
    <div class="code-container" style="justify-content: center;align-items: center;">
        <video id="video" autoplay playsinline style="width:1280px; height:720px"></video>
        <audio id="audio" autoplay controls hidden></audio>
    </div>
    <button onclick="rtc.register('lisa_casual_720_pl')" class="send-btn" style="margin: 15px">Connect</button>
    <div style="position: relative;">
        <div style="position: absolute; bottom: 0; right: 0; background-color: rgba(122,112,179,0.17); padding: 10px; margin: 10px; border-radius: 10px;">
            <span style="color: white;" id="timestamp">00.0000</span>
        </div>
    </div>
</div>
<script>
    let app = {
        video: document.getElementById('video'),
        audio: document.getElementById('audio'),
        ai_response: '',
        timestamp: null
    }
    rtc = new AvatarRTCClient("http://localhost:8000", app.video, app.audio)
    rtc.on(AvatarRTCClient.OPEN, () => {
        console.log('RTC open');
    })
</script>

<div class="card" style="max-width: 46.1%">
    <div class="card-header">Short Avatar Repeat Request</div>
    <div class="code-container">
        <pre contenteditable="true" class="editable-code" style="white-space: pre-wrap; word-wrap: break-word;">
            <!--@formatter:off-->
{"avatar":{"repeat":"hello samira how are you today", "persona":"lisa_casual_720_pl", "voice_id":"pNInz6obpgDQGcFmaJgB"}}
            <!--@formatter:on-->
        </pre>
        <button class="send-btn" onclick="avatar_send(this)">Send</button>
    </div>
</div>

<div class="card" style="max-width: 46.1%">
    <div class="card-header">LLM Request</div>
    <div class="code-container">
        <pre contenteditable="true" class="editable-code" style="white-space: pre-wrap; word-wrap: break-word;">
            <!--@formatter:off-->
{"llm":{"query":"what is search engine?", "stream":true, "history":[]}}
            <!--@formatter:on-->
        </pre>
        <button class="send-btn" onclick="llm_send(this)">Send</button>
    </div>
</div>

<div class="card" style="max-width: 95%;">
    <div class="card-header">LLM Response</div>
    <div class="code-container">
        <div id="llm-response"></div>
    </div>
</div>

<div class="card">
    <div class="card-header">Long Avatar Repeat Request</div>
    <div class="code-container">
        <pre contenteditable="true" class="editable-code" style="white-space: pre-wrap; word-wrap: break-word;">
            <!--@formatter:off-->
{"avatar":{"repeat":"Healthcare in the United States is a complex and multifaceted system that combines public and private elements, presenting both opportunities and challenges for individuals, policymakers, and the economy. It is often described as one of the most advanced healthcare systems in the world in terms of medical technology, research, and access to specialized care. However, it is also marked by disparities in access, affordability, and outcomes, which contribute to ongoing debates about reform and improvement. The healthcare system is largely dominated by private insurance companies, with a significant portion of the population receiving coverage through employer-sponsored insurance plans. In addition to these private plans, there are public health programs like Medicaid and Medicare that provide coverage for low-income individuals and those over the age of 65, respectively. However, a substantial number of Americans remain uninsured or underinsured, which has led to concerns about the overall effectiveness and equity of the system.", "persona":"lisa_casual_720_pl", "voice_id":"pNInz6obpgDQGcFmaJgB"}}
            <!--@formatter:on-->
        </pre>
        <button class="send-btn" onclick="avatar_send(this)">Send</button>
    </div>
</div>

<script>
    function avatar_send(button) {
        const codeText = button.previousElementSibling.textContent.trim();
        console.log(codeText);
        rtc.request(codeText);
        button.textContent = 'Sending...';
        setTimeout(() => {
            button.textContent = 'Send';
        }, 1000);
    }

    function llm_send(button) {
        const codeText = button.previousElementSibling.textContent.trim();
        console.log(codeText);
        app.ai_response = '';
        rtc.request(codeText, (payload) => {
            console.log(payload);
            app.ai_response += payload;
            document.getElementById('llm-response').innerHTML = marked.parse(app.ai_response);
        });
        button.textContent = 'Sending...';
        setTimeout(() => {
            button.textContent = 'Send';
        }, 1000);
    }
</script>


</body>
</html>