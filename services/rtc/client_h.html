<html lang="en">
<head>
    <title>RTC Client</title>
    <script src="js/rtc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        html {
            color-scheme: dark !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0px;
            background-color: #2c2f30;
            color: #fcf7f1;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin-left: 5%;
            margin-right: 5%;
        }

        @media screen and (min-width: 1920px) {
            body {
                margin-left: 20%;
                margin-right: 20%;
            }
        }

        .card {
            background-color: #252627;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            width: 100%;
            max-width: 95%;
            display: inline-block;
            margin: 10px;
        }

        .code-container {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-container pre {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 16px;
            padding: 0;
            margin: 0;
        }

        .send-btn {
            background-color: #0082a1;
            color: #e5dfd1;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .send-btn:hover {
            background-color: #4fa3d1;
            transform: scale(1.05);
        }

        .send-btn:focus {
            outline: none;
        }

        .card-header {
            font-size: 20px;
            font-weight: bold;
            color: whitesmoke;
            margin-bottom: 15px;
        }

        #avatar-repeat {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            color: #d6c5c5;
            border-radius: 12px;
            background-color: #242429;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            margin: 8px 24px 8px 8px;
            transition: border 0.3s, box-shadow 0.3s;
        }

        #avatar-repeat:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

    </style>

</head>
<body>
<div class="card">
    <div class="code-container" style="justify-content: center;align-items: center;">
        <video id="video" autoplay playsinline style="width:1280px; height:720px"></video>
        <audio id="audio" autoplay controls hidden></audio>
    </div>

    <button onclick="rtc.register('bbdf6602f16c43399fb3cfc8298d52f3','21m00Tcm4TlvDq8ikWAM')" class="send-btn"
            style="margin: 15px">Connect
    </button>
    <!--    <button onclick="rtc.register('lisa_casual_720_pl','21m00Tcm4TlvDq8ikWAM')" class="send-btn" style="margin: 15px">Connect</button>-->
    <button onclick="rtc.stop();" class="send-btn" style="margin: 15px">Stop</button>
    <button onclick="rtc.disconnect();" class="send-btn" style="margin: 15px">Disconnect</button>
    <button onclick="repeat(this, 'Hello!');" class="send-btn" style="margin: 15px">Say Hello</button>

    <div style="position: relative;">
        <div style="position: absolute; bottom: 0; right: 0; background-color: rgba(122,112,179,0.17); padding: 10px; margin: 10px; border-radius: 10px;">
            <span style="color: white;" id="timestamp">00.0000</span>
        </div>
    </div>
</div>
<script>
    let app = {
        video: document.getElementById('video'),
        audio: document.getElementById('audio'),
        ai_response: '',
        timestamp: null
    }
    rtc = new AvatarRTCClient("http://localhost:8000", app.video, app.audio)
    rtc.on(AvatarRTCClient.OPEN, () => {
        console.log('RTC open');
    })
</script>

<div class="card" style="max-width: 95%">
    <div class="card-header">Avatar Repeat Request</div>
    <div class="code-container">
        <label for="avatar-repeat"></label><input type="text" id="avatar-repeat">
        <button class="send-btn" onclick="repeat(this)">Send</button>
    </div>
</div>

<div class="card" style="max-width: 95%">
    <div class="card-header">Tool Request</div>
    <div class="code-container">
        <pre contenteditable="true" class="editable-code" style="white-space: pre-wrap; word-wrap: break-word;">
            <!--@formatter:off-->
{"llm":{"query":"what is search engine?", "stream":true, "history":[]}}
            <!--@formatter:on-->
        </pre>
        <button class="send-btn" onclick="llm_send(this)">Send</button>
    </div>
</div>

<div class="card" style="max-width: 95%;">
    <div class="card-header">LLM Response</div>
    <div class="code-container">
        <div id="llm-response"></div>
    </div>
</div>

<div class="card">
    <div class="card-header">Long Avatar Repeat Request</div>
    <div class="code-container">
        <code>
            Healthcare in the United States is a complex and multifaceted system that combines public and private
            elements,
            presenting both opportunities and challenges for individuals, policymakers, and the economy. It is often
            described as one of the most advanced healthcare systems in the world in terms of medical technology,
            research,
            and access to specialized care. However, it is also marked by disparities in access, affordability, and
            outcomes, which contribute to ongoing debates about reform and improvement. The healthcare system is largely
            dominated by private insurance companies, with a significant portion of the population receiving coverage
            through employer-sponsored insurance plans. In addition to these private plans, there are public health
            programs
            like Medicaid and Medicare that provide coverage for low-income individuals and those over the age of 65,
            respectively. However, a substantial number of Americans remain uninsured or underinsured, which has led to
            concerns about the overall effectiveness and equity of the system.
        </code>
        <button class="send-btn" onclick="avatar_send(this)">Send</button>
    </div>
</div>

<script>
    function repeat(button, text) {
        const bt = button.textContent
        button.textContent = 'Sending...';
        app.timestamp = new Date().getTime();
        text = text ?? document.getElementById('avatar-repeat').value
        console.log(text)
        rtc.hey_repeat(text, (payload) => {
            console.log(payload)
            button.textContent = bt;
            let timestamp = new Date().getTime() - app.timestamp;
            document.getElementById('timestamp').innerHTML = (timestamp / 1000) + "s";
        })
    }

    function avatar_send(button) {
        button.textContent = 'Sending...';
        const text = button.previousElementSibling.textContent.trim();
        console.log(text)
        app.timestamp = new Date().getTime();
        rtc.hey_repeat(text, () => {
            button.textContent = 'Send';
            let timestamp = new Date().getTime() - app.timestamp;
            document.getElementById('timestamp').innerHTML = (timestamp / 1000) + "s";
        });
    }

    function llm_send(button) {
        button.textContent = 'Sending...';
        const codeText = button.previousElementSibling.textContent.trim();
        console.log(codeText);
        app.ai_response = '';
        rtc.request(codeText, {
            '200': (packet) => {
                console.log(packet);
                button.textContent = 'Send';
                app.ai_response += packet['payload'];
                document.getElementById('llm-response').innerHTML = marked.parse(app.ai_response);
            }
        });
    }
</script>


</body>
</html>